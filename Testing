SELECT
    ALRT_EV.EV_ID,
    ALRT.ALRT_ID,
    ALRT.TYP_ID,
    CASE ALRT_TYP.ALRT_TYP
        WHEN 'Pending Approval / Pending Secondary Approval' THEN 'Pending Approval'
        ELSE ALRT_TYP.ALRT_TYP
    END AS ALRT_TYP,
    ALRT_GRP.GRP_SHORT_DESC,
    ALRT_HST.USER_SK,
    ALRT_HST.SUBJ_TXT,
    ALRT_HST.MSG_TXT,
    ALRT_HST.LONG_MSG_TXT,
    ALRT_HST.COMM_CTR_IND,
    ALRT_HST.RECIP_ADDR,
    ALRT_HST.CREAT_BY,
    ALRT_HST.CREAT_TM,
    ALRT_HST.UPD_BY,
    ALRT_HST.UPD_TM,
    ALRT_HST.PBD_IND,
    COALESCE(MSG_FLG.MSG_READ_FLAG, 'N') AS MSG_READ_FLAG,
    COALESCE(MSG_FLG.MSG_DEL_FLAG, 'N') AS MSG_DEL_FLAG
FROM DEV_NPF_DB.CDC_DIRECT.NPF_ALRT_HIST ALRT_HST
LEFT JOIN DEV_NPF_DB.CDC_DIRECT.NPF_ALRT_EV ALRT_EV ON ALRT_HST.EV_ID = ALRT_EV.EV_ID
LEFT JOIN DEV_ANCHOR_ANALYTICS.WP_SRC.NPF_ALERT ALRT ON ALRT_EV.ALRT_ID = ALRT.ALRT_ID
LEFT JOIN DEV_NPF_DB.CDC_DIRECT.NPF_ALRT_TYPE ALRT_TYP ON ALRT.TYP_ID = ALRT_TYP.TYP_ID
LEFT JOIN DEV_NPF_DB.CDC_DIRECT.NPF_ALRT_GRP ALRT_GRP ON ALRT_TYP.GRP_ID = ALRT_GRP.GRP_ID
LEFT JOIN DEV_NPF_DB.CDC_DIRECT.WPA_ALRT_MSG_FLG MSG_FLG ON ALRT_HST.EV_ID = MSG_FLG.EV_ID
WHERE ALRT_HST.USER_SK = 402362
ORDER BY ALRT_HST.CREAT_TM DESC;
